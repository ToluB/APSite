<div id="<%= dom_id(convo) %>">
	<div class="convo" data-convo-id="<%= convo.id %>">
	
	  <%= render 'users/user', :user => convo.user %>
	
		<span class="title">
		<%=link_to convo.title, posts_url(:convo_id => convo.id) %><br>
	  </span>
	
		<%= render 'shared/merits', :merits => convo.merits %>
	
		<span class="content">
	  <%= raw convo.content %><br>
		</span>
	</div>
</div>

<script>

$('.upmerit').click(function(){
	meritDiv=$(this).siblings('.merits');
	var id = meritDiv.parent().data('convo-id');
			var merits = parseInt(meritDiv.text());
		  merits += 1;
		
			$.ajax({
				url: "<%= convo_url(convo.id)%>",
				type: "POST",
				dataType: "json",
				data: { _method: "PUT", id: id, post: { merits: merits } }
			}).success(function(){
				meritDiv.text(merits);
			}).fail(function(data){
				alert("Sorry, request failed");
			});
});

$('.demerit').click(function(){
	meritDiv=$(this).siblings('.merits');
	var id = meritDiv.parent().data('convo-id');
			var merits = parseInt(meritDiv.text());
		
		  merits -= 1;
		
			$.ajax({
				url: "/convos/"+id,
				type: "POST",
				dataType: "json",
				data: { _method: "PUT", id: id, post: { merits: merits } }
			}).success(function(){
				meritDiv.text(merits);
			}).fail(function(data){
				alert("Sorry, request failed");
			});
});

</script>
